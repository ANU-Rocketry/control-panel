(this.webpackJsonpreactfront=this.webpackJsonpreactfront||[]).push([[0],{32:function(t){t.exports=JSON.parse('{"buttons":[{"pin":{"test_stand":"ETH","labjack_pin":14,"name":"Main Fuel (Ethanol) Valve","abbrev":"main"},"position":{"width":2,"height":1,"x":11.5,"y":15}},{"pin":{"test_stand":"ETH","labjack_pin":12,"name":"Fuel (Ethanol) Fill Valve","abbrev":"fill"},"position":{"width":2,"height":1,"x":8,"y":13}},{"pin":{"test_stand":"ETH","labjack_pin":10,"name":"Fuel (Ethanol) Dump/Drain Valve","abbrev":"drain"},"position":{"width":2,"height":1,"x":4,"y":13}},{"pin":{"test_stand":"ETH","labjack_pin":8,"name":"Fuel (Ethanol) Tank Nitrogen Pressurisation Valve","abbrev":"pres"},"position":{"width":2,"height":1,"x":8,"y":4}},{"pin":{"test_stand":"ETH","labjack_pin":19,"name":"Fuel (Ethanol) Tank Vent Valve","abbrev":"vent"},"position":{"width":2,"height":1,"x":11,"y":1}},{"pin":{"test_stand":"ETH","labjack_pin":17,"name":"Fuel (Ethanol) Line Nitrogen Purge Valve","abbrev":"purge"},"position":{"width":2,"height":1,"x":8,"y":17}},{"pin":{"test_stand":"LOX","labjack_pin":16,"name":"Main Oxidiser (LOX) Valve","abbrev":"main"},"position":{"width":2,"height":1,"x":17.5,"y":15}},{"pin":{"test_stand":"LOX","labjack_pin":18,"name":"Oxidiser (LOX) Fill Valve","abbrev":"fill"},"position":{"width":2,"height":1,"x":21,"y":13}},{"pin":{"test_stand":"LOX","labjack_pin":9,"name":"Oxidiser (LOX) Dump/Drain Valve","abbrev":"drain"},"position":{"width":2,"height":1,"x":25,"y":13}},{"pin":{"test_stand":"LOX","labjack_pin":11,"name":"Oxidiser (LOX) Tank Nitrogen Pressurisation Valve","abbrev":"pres"},"position":{"width":2,"height":1,"x":21,"y":4}},{"pin":{"test_stand":"LOX","labjack_pin":13,"name":"Oxidiser (LOX) Tank Vent Valve","abbrev":"vent"},"position":{"width":2,"height":1,"x":18,"y":1}},{"pin":{"test_stand":"LOX","labjack_pin":15,"name":"Oxidiser (LOX) Line Nitrogen Purge Valve","abbrev":"purge"},"position":{"width":2,"height":1,"x":21,"y":17}}],"sensors":[{"pin":{"test_stand":"LOX","labjack_pin":1,"sensorNumber":0,"name":"LOX Nitrogen Pressurant Sensor","abbrev":"lox_n2"},"position":{"width":5,"height":3,"x":25,"y":3}},{"pin":{"test_stand":"LOX","labjack_pin":3,"sensorNumber":1,"name":"LOX Tank Pressure Sensor","abbrev":"lox_tank"},"position":{"width":3,"height":4.5,"x":17,"y":7.5}},{"pin":{"test_stand":"ETH","labjack_pin":1,"sensorNumber":2,"name":"Ethanol Nitrogen Pressurant Sensor","abbrev":"eth_n2"},"position":{"width":5,"height":3,"x":1,"y":3}},{"pin":{"test_stand":"ETH","labjack_pin":3,"sensorNumber":3,"name":"Ethanol Tank Pressure Sensor","abbrev":"eth_tank"},"position":{"width":3,"height":4.5,"x":11,"y":7.5}}]}')},67:function(t,e,n){},74:function(t,e,n){"use strict";n.r(e);var a=n(13),i=n(10),r=n(19),s=n(16),c=n(20),o=n(34),l=n(33),u=n(0),h=n.n(u),d=n(14),b=n.n(d),m=(n(67),n(3)),j=n(93),p=n(5),f=n(109),x=n(1),v=["children","title"];function O(t){var e=t.children;return Object(x.jsx)("div",{style:{width:"100%",padding:"6px",height:"40px"},children:Object(x.jsx)("h1",{children:e})})}function g(){return Object(x.jsxs)("div",{className:"top-bar",children:[Object(x.jsx)("img",{src:"./logo.png",alt:"logo"}),Object(x.jsx)("h1",{children:"Test Stand Control Panel"})]})}function y(t){var e=t.children,n=t.title,i=Object(m.a)(t,v);return Object(x.jsxs)("div",Object(a.a)(Object(a.a)({className:"panel"},i),{},{children:[Object(x.jsx)(O,{children:n}),Object(x.jsx)(j.a,{style:{width:"100%",height:"calc(100% - 52px"},children:e})]}))}var k=Object(p.a)((function(t){return{root:{width:60,height:32,padding:1,display:"flex"},switchBase:{padding:2,color:t.palette.grey[500],"&$checked":{transform:"translateX(26px)",color:t.palette.common.white,"& + $track":{opacity:1,backgroundColor:t.palette.primary.main,borderColor:t.palette.primary.main}}},thumb:{width:28,height:28,boxShadow:"none"},track:{border:"1px solid ".concat(t.palette.grey[500]),borderRadius:8,opacity:1,backgroundColor:t.palette.common.white},checked:{}}}))(f.a);Object(p.a)((function(t){return{root:{position:"absolute",top:"-10px",left:"-10px",width:"6vw"}}}))(f.a);function w(t){var e=t.value,n=t.setValue;return Object(x.jsxs)("div",{className:"toggle-switch",style:{width:60},children:[Object(x.jsx)("span",{className:e?"inactive":"active",children:"Off"}),Object(x.jsx)(k,{checked:e,onChange:function(){return n(!e)}}),Object(x.jsx)("span",{className:e?"active":"inactive",style:{textAlign:"right",width:"100%",display:"block"},children:"On"})]})}function M(t){var e="";e=t.children?t.children:Object(x.jsx)(w,{value:t.switchValue,setValue:t.setSwitchValue});var n=t.label?{cursor:"help",borderBottom:"1px dotted #333"}:{};return Object(x.jsxs)("div",{className:"safety-card",children:[Object(x.jsx)("h2",{title:t.label,style:n,children:t.title}),e]})}function S(t){var e=t.state,n=t.emit,a=t.that,i=null!==e.data&&e.data.arming_switch,r=null!==e.data&&e.data.manual_switch,s=null!==e.data&&e.data.data_logging,c=null!==e.data&&e.data.UPS_status;return Object(x.jsx)(y,{title:"Safety",className:"panel safety",children:Object(x.jsxs)("div",{className:"flex",style:{justifyContent:"flex-start"},children:[Object(x.jsx)(M,{title:"Arming Switch",label:"Controls if the state can change",isButton:"false",switchValue:i,setSwitchValue:function(t){return n("ARMINGSWITCH",t)}}),Object(x.jsx)(M,{title:"Manual Control",label:"Allow manual pin operation",isButton:"false",switchValue:r,setSwitchValue:function(t){return n("MANUALSWITCH",t)}}),Object(x.jsx)(M,{title:"Data Logging",label:"Logging data",isButton:"false",switchValue:s,setSwitchValue:function(t){return n("DATALOG",t)}}),Object(x.jsx)(M,{title:"R-Pi IP",label:"Local IP address of the Raspberry Pi. Must be on the same network. If it's incorrect no new data will appear",children:Object(x.jsx)("input",{value:e.wsAddress,size:"10",onChange:function(t){a.setState({wsAddress:t.target.value},(function(){localStorage.setItem("wsaddr",t.target.value),a.connect()}))},placeholder:e.defaultWSAddress})}),Object(x.jsxs)(M,{title:"Ping",label:"Time delay to reach the server",children:[e.ping?e.ping:"0","ms"]}),c&&Object(x.jsx)(M,{title:"UPS Status",children:c})]})})}var _=n(8),N=n(51),E=n(110),P=n(29);function L(t){if(t<0)return L(-t);if(0===t)return 0;var e=-Math.floor(Math.log10(t)),n=Math.log10(t)+e,a=[0,Math.log10(2),Math.log10(5),1],i=a[0],r=a[1],s=a[2],c=a[3],o=[Math.abs(n-i),Math.abs(n-r),Math.abs(n-s),Math.abs(n-c)],l=Math.min.apply(Math,o);return(l===o[0]?1:l===o[1]?2:l===o[2]?5:10)*Math.pow(10,-e)}function T(t,e){return parseFloat(t.toPrecision(e))}function C(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return Math.abs(t)>=1e12?"".concat(T(t/1e12,n)," T").concat(e):Math.abs(t)>=1e9?"".concat(T(t/1e9,n)," G").concat(e):Math.abs(t)>=1e6?"".concat(T(t/1e6,n)," M").concat(e):Math.abs(t)>=1e3?"".concat(T(t/1e3,n)," k").concat(e):Math.abs(t)>=1?"".concat(T(t,n)," ").concat(e):Math.abs(t)>=.001?"".concat(T(1e3*t,n)," m").concat(e):Math.abs(t)>=1e-6?"".concat(T(1e6*t,n)," \u03bc").concat(e):Math.abs(t)>=1e-9?"".concat(T(1e9*t,n)," n").concat(e):Math.abs(t)>=1e-12?"".concat(T(1e12*t,n)," p").concat(e):"0 ".concat(e)}function A(t,e,n,a){for(var i=L((e-t)/n),r=[],s=Math.ceil(t/i)*i,c=Math.floor(e/i)*i,o=s;o<=c;o+=i)Math.abs(o)<1e-10&&(o=0),r.push({tick:o,label:C(o,a)});return r}function V(t,e,n){for(var a,i=0,r=n-1;i<=r;){var s=t(a=Math.floor((i+r)/2));if(s===e)return a;s<e?i=a+1:r=a-1}return r}function X(t,e){return t?e?[Math.min(t[0],e[0]),Math.max(t[1],e[1])]:t:e}function W(t,e){var n=Object(_.a)(t,2),a=n[0],i=n[1],r=Object(_.a)(e,2);return[a+(i-a)*r[0],i-(i-a)*(1-r[1])]}function z(t,e,n){return Math.max(e,Math.min(n,t))}function I(t,e){var n=Object(_.a)(t,2),a=n[0],i=n[1],r=Object(_.a)(e,2),s=r[0],c=r[1];return a<s&&i>c?[s,c]:a<s?[s,s+(i-a)]:i>c?[c-(i-a),c]:[a,i]}var F=function(){function t(e){Object(r.a)(this,t),this.capacity=e,this.array=new Float64Array(this.capacity),this.size=0,this.chunks=0}return Object(s.a)(t,[{key:"push",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];try{this.array.set(e,this.size),this.size+=e.length,this.chunks++}catch(a){console.error(this,e),console.error(a)}}},{key:"shrink",value:function(){var t=new Float64Array(this.size);t.set(this.array.subarray(0,this.size)),this.array=t}},{key:"filterMapChunks",value:function(t,e){for(var n=[],a=0;a<this.chunks;a++)t(a)&&n.push(e(a));return n}}]),t}(),B=function(t){Object(o.a)(n,t);var e=Object(l.a)(n);function n(t){return Object(r.a)(this,n),e.call(this,4*t)}return Object(s.a)(n,[{key:"time",value:function(t){return this.array[4*t]}},{key:"mean",value:function(t){return this.array[4*t+1]}},{key:"min",value:function(t){return this.array[4*t+2]}},{key:"max",value:function(t){return this.array[4*t+3]}},{key:"updateDecimation",value:function(t){var e=t.chunks;this.chunks=Math.ceil(e/2),this.size=4*this.chunks;var n=this.size;if(0!==e)switch(e%2){case 0:this.array[n-4]=t.time(e-1),this.array[n-3]=(t.mean(e-2)+t.mean(e-1))/2,this.array[n-2]=Math.min(t.min(e-2),t.min(e-1)),this.array[n-1]=Math.max(t.max(e-2),t.max(e-1));break;case 1:this.array[n-4]=t.time(e-1),this.array[n-3]=t.mean(e-1),this.array[n-2]=t.min(e-1),this.array[n-1]=t.max(e-1)}}}]),n}(F),D=function(t){Object(o.a)(n,t);var e=Object(l.a)(n);function n(t){return Object(r.a)(this,n),e.call(this,2*t)}return Object(s.a)(n,[{key:"time",value:function(t){return this.array[2*t+0]}},{key:"mean",value:function(t){return this.array[2*t+1]}},{key:"min",value:function(t){return this.array[2*t+1]}},{key:"max",value:function(t){return this.array[2*t+1]}}]),n}(F),R=function(){function t(){Object(r.a)(this,t),this.n_bound=12,this.capacity=524288,this.arrays={},this.arrays[0]=new D(this.capacity);for(var e=1;e<=this.n_bound;e++)this.arrays[e]=new B(this.capacity>>e)}return Object(s.a)(t,[{key:"push",value:function(t,e){this.arrays[0].push(t,e);for(var n=1;n<=this.n_bound;n++)this.arrays[n].updateDecimation(this.arrays[n-1])}},{key:"sample",value:function(t,e){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,i=[Math.max(V((function(t){return n.arrays[0].time(t)}),t,this.arrays[0].chunks),0),Math.min(V((function(t){return n.arrays[0].time(t)}),e,this.arrays[0].chunks)+2,this.arrays[0].chunks)],r=i[1]-i[0],s=Math.min(this.n_bound,Math.max(0,1+Math.floor(Math.log(r/a+.01)/Math.log(2))))||0,c=[Math.max(V((function(t){return n.arrays[s].time(t)}),t,this.arrays[s].chunks),0),Math.min(V((function(t){return n.arrays[s].time(t)}),e,this.arrays[s].chunks)+2,this.arrays[s].chunks)],o=c[1]-c[0],l=new Array(o);l.min=1/0,l.max=-1/0;for(var u=0;u<o;u++)l[u]=[this.arrays[s].time(c[0]+u),this.arrays[s].mean(c[0]+u),this.arrays[s].min(c[0]+u),this.arrays[s].max(c[0]+u)],l.min=Math.min(l.min,l[u][2]),l.max=Math.max(l.max,l[u][3]);return l.decimated=s>0,l.getPoints=function(t,e,n){for(var a="",i=0;i<o;i++)a+="".concat(t(l[i][0]-n).toFixed(1),",").concat(Math.round(e(l[i][1]))," ");return a},l.getMinMaxPoints=function(t,e,n){for(var a="",i=0;i<o;i++)a+="".concat(t(l[i][0]-n).toFixed(1),",").concat(Math.round(e(l[i][2]))," ");for(var r=o-1;r>=0;r--)a+="".concat(t(l[r][0]-n).toFixed(1),",").concat(Math.round(e(l[r][3]))," ");return a},l}},{key:"samplePreview",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:200,n=this.arrays[0].chunks,a=Math.ceil(n/e),i=1/0,r=-1/0,s=this.arrays[0].filterMapChunks((function(t){return t%a===0||t===n-1}),(function(e){var n=t.arrays[0].mean(e);return i=Math.min(i,n),r=Math.max(r,n),[t.arrays[0].time(e),n]}));return s.min=i,s.max=r,s.getPoints=function(t,e,n){for(var a="",i=0;i<s.length;i++)a+="".concat(t(s[i][0]-n).toFixed(1),",").concat(Math.round(e(s[i][1]))," ");return a},s}},{key:"shrink",value:function(){for(var t=0;t<=this.n_bound;t++)this.arrays[t].shrink()}}]),t}(),H=function(){function t(){Object(r.a)(this,t),this.series=[new R]}return Object(s.a)(t,[{key:"push",value:function(t,e){isNaN(t)||isNaN(e)?this.series[this.series.length-1].arrays[0].chunks>0&&(this.series[this.series.length-1].shrink(),this.series.push(new R)):this.series[this.series.length-1].push(t,e)}},{key:"sample",value:function(t,e,n){var a=this.series.map((function(a){return a.sample(t,e,n)}));return a.totalLength=a.reduce((function(t,e){return t+e.length}),0),a.splitPointIndex=function(t){for(var e=0;e<a.length;e++){if(t<a[e].length)return[e,t];if((t-=a[e].length)<0)return[-1,-1]}},a.fromPointIndex=function(t){var e=a.splitPointIndex(t),n=Object(_.a)(e,2),i=n[0],r=n[1];return a[i][r]},a.min=Math.min.apply(Math,Object(i.a)(a.map((function(t){return t.min})))),a.max=Math.max.apply(Math,Object(i.a)(a.map((function(t){return t.max})))),a}},{key:"samplePreview",value:function(t){if(0===this.series.length||0===this.series[0].arrays[0].chunks)return[];var e=[this.series[0].arrays[0].time(0),this.series[this.series.length-1].arrays[0].time(this.series[this.series.length-1].arrays[0].chunks-1)];if(e[0]===e[1])return[];var n=this.series.map((function(n){var a=(n.arrays[0].time(n.arrays[0].chunks-1)-n.arrays[0].time(0))/(e[1]-e[0]);return n.samplePreview(t*a)}));return n.min=Math.min.apply(Math,Object(i.a)(n.map((function(t){return t.min})))),n.max=Math.max.apply(Math,Object(i.a)(n.map((function(t){return t.max})))),n}},{key:"minTime",value:function(){var t,e;return null===(t=this.series[0])||void 0===t||null===(e=t.arrays[0])||void 0===e?void 0:e.time(0)}}]),t}(),U=function(){function t(e){Object(r.a)(this,t),this.keys=Array.from(Object.keys(e)),this.arrays=this.objectMap((function(t){return new H}))}return Object(s.a)(t,[{key:"objectMap",value:function(t){return this.keys.reduce((function(e,n){return e[n]=t(n),e}),{})}},{key:"minTime",value:function(){var t=this;return Math.min.apply(Math,Object(i.a)(this.keys.map((function(e){return t.arrays[e].minTime()})).filter((function(t){return t}))))}},{key:"sample",value:function(t,e){var n=this,a=this.objectMap((function(a){var r;return(r=n.arrays[a]).sample.apply(r,Object(i.a)(t).concat([e]))}));return a.min=Math.min.apply(Math,Object(i.a)(this.keys.map((function(t){return a[t].min})))),a.max=Math.max.apply(Math,Object(i.a)(this.keys.map((function(t){return a[t].max})))),a}},{key:"samplePreview",value:function(t){var e=this,n=this.objectMap((function(n){return e.arrays[n].samplePreview(t)}));return n.min=Math.min.apply(Math,Object(i.a)(this.keys.map((function(t){return n[t].min})))),n.max=Math.max.apply(Math,Object(i.a)(this.keys.map((function(t){return n[t].max})))),n}}]),t}(),G=n(32),J=["time"];window.enablePageScroll=P.enablePageScroll,window.disablePageScroll=P.disablePageScroll;var q=null,Q=[-10,10],Y=function(t){return document.dispatchEvent(new CustomEvent("datalogger-new-data",{detail:t}))};var $=function(t){var e=t.series,n=t.unit,r=(t.label,Array.from(Object.keys(e))),s=new U(e),c=[],o=function(){},l=function(){return requestAnimationFrame(o)};return document.addEventListener("datalogger-new-data",(function(t){var e,n=t.detail,a=Object(N.a)(r);try{for(a.s();!(e=a.n()).done;){var i=e.value;i in n&&s.arrays[i].push(n.time,n[i])}}catch(c){a.e(c)}finally{a.f()}l()})),document.addEventListener("datalogger-new-event",(function(t){var e=t.detail;c.push(Object(a.a)(Object(a.a)({},e),{},{key:c.length})),l()})),function(t){var l=t.currentSeconds,u=h.a.useRef(null);o=h.a.useReducer((function(t){return t+1}),0)[1];var d=600,b=450;l||(l=(new Date).getTime()/1e3);var j,p,f,v=s.minTime(),O=h.a.useState([-3]),g=Object(_.a)(O,2),y=g[0],k=g[1],w=function(t){if(1===t.length||t[1]>=l){var e=1===t.length?t[0]:t[0]-l,n=Math.min(-10,v-l);k([z(e,n,0)])}else t=[Math.min.apply(Math,Object(i.a)(t)),Math.max.apply(Math,Object(i.a)(t))],k([z(t[0],v,t[1]-.01),z(t[1],t[0],l)])},M=1===y.length?[l+y[0],l]:y,S=[M[0]-l,M[1]-l],N=s.sample(M,d),L=s.samplePreview(d);j=q,p=X([N.min,N.max],Q),f=.1,q=j?p?[j[0]+(p[0]-j[0])*f,j[1]+(p[1]-j[1])*f]:j:p;var T=h.a.useState([0,1]),F=Object(_.a)(T,2),B=F[0],D=F[1],R=function(t,e){var n=Object(_.a)(t,2);return W([n[0],n[1]],[-e,1+e])}(W(q,B),.2),H=[v,l],U=1,G=1,Y=1,$=1,K=function(t){return U+t*(d-U-G)},Z=function(t){return Y+t*(400-Y-$)},tt=function(t){return(t-U)/(d-U-G)},et=function(t){return K((t-S[0])/(S[1]-S[0]))},nt=function(t){return Z(1-(t-R[0])/(R[1]-R[0]))},at=function(t){return S[0]+tt(t)*(S[1]-S[0])},it=6,rt=12,st=function(t){return e=1-(t-L.min)/(L.max-L.min),it+e*(50-it-rt);var e},ct=function(t){return K(1-t/(Math.min(H[1]-10,H[0])-H[1]))},ot=function(t){return(1-tt(t))*(Math.min(H[1]-10,H[0])-H[1])},lt=A.apply(void 0,S.concat([4,"s"])),ut=A.apply(void 0,Object(i.a)(R).concat([6,"psi"])),ht=h.a.useState(null),dt=Object(_.a)(ht,2),bt=dt[0],mt=dt[1],jt=r.map((function(t){if(!N[t].length)return null;var e=V((function(e){return N[t].fromPointIndex(e)[0]}),l+at(bt),N[t].totalLength-1);if(-1===e)return null;var n=N[t].splitPointIndex(e),a=Object(_.a)(n,2),i=a[0],r=a[1];return r>=N[t][i].length-1||i<0||r<0?null:[i,r]})).map((function(t,e){if(null===t)return"";var a,i,s,c,o,u=Object(_.a)(t,2),h=u[0],d=u[1],b=N[r[e]],m=(a=b[h][d][0],i=b[h][d][1],s=b[h][d+1][0],c=b[h][d+1][1],o=l+at(bt),i+(c-i)*(o-a)/(s-a));return"".concat(r[e],": ").concat(C(m,n))})).filter((function(t){return t.length})),pt=bt>K(1)-200,ft=h.a.useState(!1),xt=Object(_.a)(ft,2),vt=xt[0],Ot=xt[1],gt=h.a.useState(null),yt=Object(_.a)(gt,2),kt=yt[0],wt=yt[1],Mt=function(t){var e;return t.clientX-(null===(e=u.current)||void 0===e?void 0:e.getBoundingClientRect().left)},St=c.map((function(t){var e=t.time,n=Object(m.a)(t,J);return Object(a.a)({x:et(e-l)},n)})).filter((function(t){var e=t.x;return e>=K(0)-10&&e<=K(1)}));h.a.useEffect((function(){document.body.addEventListener("mouseup",(function(){Ot(!1),wt(null),zt(!1),Dt(null),Pt(!1),At(null)}))}),[]);var _t=h.a.useState(!1),Nt=Object(_.a)(_t,2),Et=Nt[0],Pt=Nt[1],Lt=h.a.useState(null),Tt=Object(_.a)(Lt,2),Ct=Tt[0],At=Tt[1],Vt=h.a.useState(!1),Xt=Object(_.a)(Vt,2),Wt=Xt[0],zt=Xt[1],It=h.a.useState(null),Ft=Object(_.a)(It,2),Bt=Ft[0],Dt=Ft[1],Rt=function(t,e){Pt(!0),At(e)},Ht=function(t){var e=Mt(t);if(Wt){var n=Object(_.a)(Bt,2),a=n[0],r=n[1],s=ot(e)-a,c=[r[0]+s,r[1]+s];w(I(c,X(H,[l-10,l])))}if(Et){var o=Ct,u=Object(i.a)(M);u[o]=z(l+ot(e),Math.min(H[1]-10,H[0]),H[1]),0===o?u[0]=Math.min(u[1]-.01,u[0]):u[1]=Math.max(u[0]+.01,u[1]),w(u)}};return Object(x.jsxs)("div",{onMouseMove:function(t){return Wt?Ht(t):function(t){var e=Mt(t);if(mt(e),vt){var n=Object(_.a)(kt,2),a=n[0],i=n[1],r=at(a)-at(e),s=[i[0]+r,i[1]+r];s=I(s,X(H,[l-10,l])),w(s)}}(t)},children:[Object(x.jsxs)("svg",{viewBox:"0 0 ".concat(d," ").concat(400),xmlns:"http://www.w3.org/2000/svg",width:d,height:400,style:{userSelect:"none",fontFamily:"sans-serif"},ref:u,onMouseOver:function(){return Object(P.disablePageScroll)()},onMouseOut:function(t){var e,n=null===(e=u.current)||void 0===e?void 0:e.getBoundingClientRect();Object(P.enablePageScroll)(),(t.clientX<n.left||t.clientX>n.right||t.clientY<n.top||t.clientY>n.bottom)&&mt(null)},onMouseDown:function(t){Ot(!0),wt([Mt(t),M])},onWheel:function(t){var e=t.deltaX+t.deltaY,n=1===y.length?M[1]:bt?l+at(bt):(M[0]+M[1])/2,a=Math.max(n+(M[0]-n)*Math.pow(1.001,-e),Math.min(H[0]+.01,l-10)),i=Math.min(n+(M[1]-n)*Math.pow(1.001,-e),H[1]);w([Math.min(a,i-.01),i])},children:[lt.map((function(t){var e=t.tick;t.label;return Object(x.jsx)("line",{x1:et(e),y1:Z(1),x2:et(e),y2:Z(0),stroke:"#ddd"},e)})),Object(x.jsx)("line",{x1:K(0),y1:Z(1),x2:K(1),y2:Z(1),stroke:"#888",strokeWidth:"2"}),ut.map((function(t){var e=t.tick;t.label;return Object(x.jsx)("line",{x1:K(0),y1:nt(e),x2:K(1),y2:nt(e),stroke:"#ddd"},e)})),Object(x.jsx)("line",{x1:K(0),y1:0,x2:K(0),y2:b,stroke:"#888",strokeWidth:"2"}),St.map((function(t,e){var n=t.x,a=t.label,i=t.key;return Object(x.jsxs)("g",{children:[Object(x.jsx)("line",{x1:n,y1:Z(0),x2:n,y2:Z(1),stroke:"#333",strokeWidth:"1",strokeDasharray:"2 4"}),Object(x.jsx)("text",{x:n+5,y:Z(1)-e%10*10-20,textAnchor:"start",alignmentBaseline:"text-after-edge",fontSize:"12",children:a})]},i)})),r.map((function(t){return Object(x.jsxs)("g",{children:[N[t].map((function(n,a){return n.length&&n.decimated&&Object(x.jsx)("polygon",{points:n.getMinMaxPoints(et,nt,l),fill:e[t].color,opacity:"0.5",stroke:"none",strokeWidth:"0"},a)})),N[t].map((function(n,a){return n.length&&Object(x.jsx)("polyline",{points:n.getPoints(et,nt,l),fill:"none",stroke:e[t].color,strokeWidth:"1"},a)}))]},t)})),lt.map((function(t){var e=t.tick,n=t.label;return et(e)-K(0)>40&&Object(x.jsx)("text",{x:et(e),y:Z(1)-2,textAnchor:"middle",alignmentBaseline:"after-edge",fontSize:"12",children:n},e)})),ut.map((function(t){var e=t.tick,n=t.label;return Z(1)-nt(e)>20&&Object(x.jsx)("text",{x:K(0)+2,y:nt(e),textAnchor:"start",alignmentBaseline:"after-edge",fontSize:"12",children:n},e)})),r.map((function(t,n){return Object(x.jsxs)("g",{children:[Object(x.jsx)("circle",{r:"3.5",fill:e[t].color,cx:590,cy:12+20*n}),Object(x.jsx)("text",{fontSize:"12",x:580,textAnchor:"end",alignmentBaseline:"middle",fill:e[t].color,y:13+20*n,children:t})]},t)})),jt.length&&bt>K(0)&&Object(x.jsxs)("g",{children:[Object(x.jsx)("line",{x1:bt,y1:Z(0),x2:bt,y2:Z(1),stroke:"black",strokeWidth:"1"}),jt.map((function(t,e){return Object(x.jsx)("text",{x:Math.max(50,Math.min(bt+(pt?-5:5),K(1)-100)),y:Z(0)+20+16*e,textAnchor:pt?"end":"start",alignmentBaseline:"text-after-edge",fontSize:"12",children:t},e)}))]})]}),Object(x.jsxs)("svg",{viewBox:"0 0 ".concat(d," ",50),xmlns:"http://www.w3.org/2000/svg",width:d,height:50,style:{userSelect:"none",fontFamily:"sans-serif"},onMouseOut:function(t){Object(P.enablePageScroll)()},onMouseMove:Ht,onMouseDown:function(t){zt(!0),Dt([ot(Mt(t)),M])},children:[Object(x.jsx)("rect",{x:ct(S[0]),y:-2,width:ct(S[1])-ct(S[0]),height:54,fill:"#eee",stroke:"#999",strokeWidth:"2"}),r.map((function(t){return Object(x.jsx)("g",{children:L[t].map((function(n,a){return n.length&&Object(x.jsx)("polyline",{points:n.getPoints(ct,st,l),fill:"none",stroke:e[t].color,strokeWidth:"1"},a)}))},t)})),Object(x.jsxs)("text",{x:"2",y:"50",alignmentBaseline:"text-after-edge",textAnchor:"start",fontSize:"12",fill:"grey",children:[Math.max(10,Math.round(H[1]-H[0])),"s ago"]}),Object(x.jsx)("text",{x:598,y:"50",alignmentBaseline:"text-after-edge",textAnchor:"end",fontSize:"12",fill:"grey",children:"now"}),Object(x.jsx)("rect",{x:ct(S[1])-4,y:10,width:8,height:30,fill:"#999",stroke:"none",strokeWidth:"0",rx:"4"}),Object(x.jsx)("rect",{x:ct(S[0])-4,y:10,width:8,height:30,fill:"#999",stroke:"none",strokeWidth:"0",rx:"4"}),Object(x.jsx)("rect",{x:ct(S[1])-6,onMouseDown:function(t){return Rt(0,1)},y:"0",width:"16",height:"50",fill:"transparent",stroke:"none",strokeWidth:"0",cursor:"col-resize"}),Object(x.jsx)("rect",{x:ct(S[0])-10,onMouseDown:function(t){return Rt(0,0)},y:"0",width:"16",height:"50",fill:"transparent",stroke:"none",strokeWidth:"0",cursor:"col-resize"})]}),Object(x.jsx)("button",{className:"jump-to-present "+(1!==y.length?"active":""),onClick:function(){return w([y[0]-y[1]])},children:">"}),Object(x.jsx)(E.a,{value:B,onChange:function(t,e){D([Math.min.apply(Math,Object(i.a)(e)),Math.max.apply(Math,Object(i.a)(e))])},valueLabelDisplay:"off",min:0,max:1,style:{width:560,marginLeft:50},step:.005,marks:[{value:0,label:"Bottom"},{value:1,label:"Top"}]}),Object(x.jsx)("button",{onClick:function(){var t=u.current,e=(new XMLSerializer).serializeToString(t),n=new Blob([e],{type:"image/svg+xml"}),a=URL.createObjectURL(n),i=document.createElement("a");i.href=a,i.download="graph.svg",i.click()},children:"Download SVG"})]})}}({unit:"psi",series:{"LOX Tank":{color:"#000"},"LOX N2":{color:"#f00"},"ETH Tank":{color:"#3d6"},"ETH N2":{color:"#09f"}}});function K(t){var e,n=t.state;return Object(x.jsx)(y,{title:"Graphs",className:"panel graphs",children:Object(x.jsx)($,{currentSeconds:null===(e=n.data)||void 0===e?void 0:e.time})})}var Z=n(35),tt=n.n(Z),et=n(45),nt=n(107),at=n(97),it=n(98),rt=n(99),st=n(100),ct=n(101),ot=n(102),lt=n(103),ut=n(104),ht=n(105),dt=n(106);function bt(t){var e,n=t.state,a=t.emit,i=null!==(e=n.data&&n.data.current_sequence)&&void 0!==e?e:[],r=null===n.data?null:n.data.command_in_flight,s=h.a.useState(!1),c=Object(_.a)(s,2),o=c[0],l=c[1],u=function(){var t=Object(et.a)(tt.a.mark((function t(e){var n,i;return tt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.target.files.length){t.next=2;break}return t.abrupt("return");case 2:if(n=e.target.files[0],!1===(i=m(n))){t.next=12;break}return t.t0=a,t.next=8,i;case 8:t.t1=t.sent,(0,t.t0)("SETSEQUENCE",t.t1),t.next=13;break;case 12:l(!0);case 13:e.target.value="";case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function d(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",n=t.split("\n"),a=n.map((function(t){return t.split(e).map((function(t){return t.trim()}))}));return a}var b=function(t){var e=new FileReader;return new Promise((function(n,a){e.onerror=function(){e.abort(),a(new DOMException("Problem parsing input file."))},e.onload=function(){n(e.result)},e.readAsText(t)}))};function m(t){return j.apply(this,arguments)}function j(){return(j=Object(et.a)(tt.a.mark((function t(e){var n,a,i;return tt.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b(e);case 2:n=t.sent,a=d(n),i=[],t.prev=5,a.forEach((function(t){if("OPEN"===t[0]||"CLOSE"===t[0]){if(3!==t.length)throw new Error("invalid input");if("lox"!==t[1].toLowerCase()&&"eth"!==t[1].toLowerCase())throw new Error("invalid input");var e=Number.parseInt(t[2]);if(!e)throw new Error("invalid input");i.push({header:t[0],parameter:{name:t[1],pin:e}})}else{if("SLEEP"!==t[0]){if(""===t[0])return;throw new Error("invalid input")}if(2!==t.length)throw new Error("invalid input");var n=Number.parseInt(t[1]);if(!n)throw new Error("invalid input");i.push({header:t[0],parameter:n})}})),t.next=12;break;case 9:return t.prev=9,t.t0=t.catch(5),t.abrupt("return",!1);case 12:return t.abrupt("return",i);case 13:case"end":return t.stop()}}),t,null,[[5,9]])})))).apply(this,arguments)}var p=n.data&&n.data.arming_switch;return Object(x.jsxs)(y,{title:"Sequences",children:[Object(x.jsx)("div",{children:Object(x.jsxs)(nt.a,{open:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(x.jsx)(at.a,{id:"alert-dialog-title",children:"Invalid CSV"}),Object(x.jsx)(it.a,{children:Object(x.jsx)(rt.a,{id:"alert-dialog-description",children:"Confirm the CSV given was valid, read documentation if unsure."})}),Object(x.jsx)(st.a,{children:Object(x.jsx)(ct.a,{onClick:function(){l(!1)},color:"primary",autoFocus:!0,children:"Understood!"})})]})}),Object(x.jsxs)("div",{className:"flex",children:[Object(x.jsx)("div",{style:{width:"200px",borderRight:"1px solid #999",height:"100%"},children:Object(x.jsxs)("div",{className:"frame",children:[Object(x.jsx)("h2",{children:"Start Sequence"}),Object(x.jsx)("div",{children:Object(x.jsx)("input",{type:"file",accept:".csv",maxLength:"1",onChange:u})}),Object(x.jsx)("br",{}),Object(x.jsx)("button",{onClick:function(){return a("BEGINSEQUENCE",null)},style:{backgroundColor:p?"lime":"lightgrey",padding:10,cursor:"pointer"},children:"Start"}),Object(x.jsx)("br",{}),Object(x.jsx)("br",{}),Object(x.jsx)(M,{title:"Run Abort Sequence",children:Object(x.jsx)("button",{onClick:function(){return a("ABORTSEQUENCE",t);var t},style:{backgroundColor:p?"tomato":"lightgrey",padding:10,cursor:"pointer"},children:"ABORT"})})]})}),Object(x.jsx)("div",{style:{overflow:"auto",width:"100%",height:"100%"},children:Object(x.jsxs)(ot.a,{stickyHeader:!0,"aria-label":"simple table",children:[Object(x.jsx)(lt.a,{children:Object(x.jsxs)(ut.a,{children:[Object(x.jsx)(ht.a,{align:"center",children:"Command"}),Object(x.jsx)(ht.a,{align:"center",children:"LabJack"}),Object(x.jsx)(ht.a,{align:"center",children:"Value"})]})}),Object(x.jsxs)(dt.a,{children:[r&&Object(x.jsxs)(ut.a,{style:{background:"#94F690"},children:[Object(x.jsx)(ht.a,{component:"th",scope:"row",children:r.header}),Object(x.jsx)(ht.a,{align:"center",children:r.data.name&&r.data.name}),Object(x.jsx)(ht.a,{align:"center",children:r.data.name?r.data.pin:((r.time-n.data.time)/1e3).toFixed(4)})]}),i.map((function(t){return Object(x.jsxs)(ut.a,{children:[Object(x.jsx)(ht.a,{component:"th",scope:"row",children:t.header}),Object(x.jsx)(ht.a,{align:"center",children:void 0===t.data.name?"":t.data.name}),Object(x.jsx)(ht.a,{align:"center",children:void 0===t.data.name?t.data:t.data.pin})]})}))]})]})})]})]})}function mt(t,e,n,a){return 14.504*((t/120-n/1e3)/(a/1e3)*e)}var jt={eth_tank:{barMax:100,zero:3.99,span:16.02},lox_tank:{barMax:100,zero:3.99,span:16.04},eth_n2:{barMax:250,zero:4,span:16},lox_n2:{barMax:250,zero:4,span:16}};function pt(t,e){return 14.504*(e/2.4*(t-.48))}var ft={time:NaN,"LOX Tank":NaN,"LOX N2":NaN,"ETH Tank":NaN,"ETH N2":NaN},xt=["state","emit"],vt=["state","emit"];function Ot(t){return"".concat(26*t,"px")}function gt(t){var e=t.x,n=t.y,i=t.width,r=t.height,s=t.enabled;return Object(a.a)({position:"absolute",borderStyle:"solid",borderColor:"transparent",width:Ot(i),height:Ot(r),top:Ot(n),left:Ot(e)},s?{}:{cursor:"help"})}function yt(t){var e=t.state,n=t.emit,a=Object(m.a)(t,xt),i=null!==e.data&&e.data.labjacks[a.test_stand].digital[a.labjack_pin],r=gt(a),s={position:"absolute",margin:"auto",fontSize:"1rem",top:Ot(a.y-1),left:Ot(a.x-1)};return Object(x.jsxs)("div",{children:[e.data&&Object(x.jsxs)("div",{style:r,title:a.enabled?"":"Please enable the arming and manual control switches to toggle",children:[Object(x.jsx)(f.a,{checked:i,onChange:function(){return e.data.labjacks[a.test_stand].digital[a.labjack_pin]?n("CLOSE",{name:a.test_stand,pin:parseInt(a.labjack_pin)}):n("OPEN",{name:a.test_stand,pin:parseInt(a.labjack_pin)})},disabled:!a.enabled}),Object(x.jsxs)("label",{className:(i?"active":"inactive")+" control-label "+(a.enabled?"":"disabled"),children:[Object(x.jsx)("br",{}),i?"Open":"Closed"]})]}),Object(x.jsx)("h4",{style:s,children:a.title})]})}function kt(t){var e=t.state,n=(t.emit,Object(m.a)(t,vt)),i=gt(Object(a.a)({enabled:!0},n)),r=null,s=null;if(e.data){r=e.data.labjacks[n.test_stand].analog[n.labjack_pin];var c=jt[n.sensorName];s=mt(r,c.barMax,c.zero,c.span)}return s&&s>29.3918&&(i.backgroundColor="tomato"),Object(x.jsxs)("div",{style:i,children:[Object(x.jsx)("div",{children:n.title}),s&&Object(x.jsxs)("div",{children:[s.toFixed(1)," PSI"]}),r&&Object(x.jsxs)("div",{children:["(",r.toFixed(2),"V)"]})]})}function wt(t){var e=t.state,n=t.emit;return Object(x.jsx)(y,{title:"Control Panel",className:"panel control",children:Object(x.jsxs)("div",{className:"control-panel",children:[G.buttons.map((function(t){return Object(x.jsx)(yt,Object(a.a)(Object(a.a)(Object(a.a)({title:t.pin.test_stand.charAt(0)+" "+t.pin.abbrev+" "+t.pin.labjack_pin,state:e,emit:n},t.pin),t.position),{},{enabled:e.data&&e.data.arming_switch&&e.data.manual_switch}),t.pin.name)})),G.sensors.map((function(t){return Object(x.jsx)(kt,Object(a.a)(Object(a.a)(Object(a.a)({title:t.pin.abbrev,state:e,emit:n},t.pin),t.position),{},{sensorName:t.pin.abbrev}),t.pin.name)}))]})})}var Mt=n(108),St=function(t){Object(o.a)(n,t);var e=Object(l.a)(n);function n(t){var a;return Object(r.a)(this,n),(a=e.call(this,t)).state={data:null,mostRecentWarning:{},showWarning:!1,wsAddress:localStorage.getItem("wsaddr")||"192.168.0.5",defaultWSAddress:"192.168.0.5",events:[]},a.emit=a.emit.bind(Object(c.a)(a)),a.connect(),a}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var t=this;this.interval=setInterval((function(){return t.emit("PING")}),200),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.mounted=!1,clearInterval(this.interval)}},{key:"connect",value:function(){var t=this;this.socket&&this.socket.close();try{this.socket=new WebSocket("ws://".concat(this.state.wsAddress,":8888")),this.socket.onopen=function(t){return console.log("websocket connection established")},this.socket.onclose=function(e){t.socket=null,console.log("websocket connection lost. reconnecting..."),Y(ft),setTimeout((function(){t.socket||t.connect()}),1e3)},this.socket.onmessage=function(e){var n;if(t.mounted){var r,s,c,o=JSON.parse(e.data);switch(o.type){case"STATE":o.data.time=parseInt(o.data.time)/1e3,o.data.time-(null===(n=t.state.data)||void 0===n?void 0:n.time)>1&&Y(ft),Y({time:(c=o.data).time,"LOX Tank":mt(c.labjacks.LOX.analog[3],jt.lox_tank.barMax,jt.lox_tank.zero,jt.lox_tank.span),"LOX N2":pt(c.labjacks.LOX.analog[1],250),"ETH Tank":mt(c.labjacks.ETH.analog[3],jt.eth_tank.barMax,jt.eth_tank.zero,jt.eth_tank.span),"ETH N2":pt(c.labjacks.ETH.analog[1],250)}),t.setState({data:o.data});break;case"PING":t.setState({ping:(new Date).getTime()-o.data});break;case"VALVE":var l=o.time/1e3,u=(s=o.data.data.pin,G.buttons.filter((function(t){return t.pin.labjack_pin===s}))[0]).pin,h=("CLOSE"===o.data.header?"Closed":"Opened")+" "+u.test_stand+" "+u.abbrev;r={time:l,label:h},document.dispatchEvent(new CustomEvent("datalogger-new-event",{detail:r})),t.setState({events:[].concat(Object(i.a)(t.state.events),[Object(a.a)(Object(a.a)({},o.data),{},{label:h,time:l})])});break;default:console.error(o)}}}}catch(e){console.error(e)}}},{key:"emit",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.socket&&this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({command:{header:t,data:e},time:(new Date).getTime()}))}},{key:"render",value:function(){var t=this;return this.state.data&&this.state.data.latest_warning&&this.state.data.latest_warning.id!==this.state.mostRecentWarning.id&&(console.log(this.state.mostRecentWarning),this.setState({mostRecentWarning:this.state.data.latest_warning,showWarning:!0})),Object(x.jsxs)("div",{children:[Object(x.jsx)(g,{}),Object(x.jsxs)("div",{className:"panels-root",children:[Object(x.jsxs)("div",{className:"panel-row-1",children:[Object(x.jsx)(S,{state:this.state,emit:this.emit,that:this}),Object(x.jsx)(bt,{state:this.state,emit:this.emit})]}),Object(x.jsxs)("div",{className:"panel-row-2",children:[Object(x.jsx)(wt,{state:this.state,emit:this.emit}),Object(x.jsx)(K,{state:this.state,emit:this.emit})]}),this.state.showWarning&&Object(x.jsx)(Mt.a,{onClose:function(){t.setState({showWarning:!1})},severity:"error",className:"alert",children:this.state.mostRecentWarning.message})]})]})}}]),n}(h.a.Component);b.a.render(Object(x.jsx)(h.a.StrictMode,{children:Object(x.jsx)(St,{})}),document.getElementById("root"))}},[[74,1,2]]]);
//# sourceMappingURL=main.7eaa5682.chunk.js.map