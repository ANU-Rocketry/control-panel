(this.webpackJsonpreactfront=this.webpackJsonpreactfront||[]).push([[0],{217:function(e,t,a){},358:function(e,t,a){"use strict";a.r(t);var n=a(101),i=a(50),s=a(42),r=a(173),c=a(198),l=a(0),o=a.n(l),h=a(25),d=a.n(h),u=(a(217),a(82)),b=a(5),j=a(380),p=a(382),O=a(359),m=a(378),x=a(12),g=a(403),v=a(3),f=["children","title"];function w(e){var t=e.children;return Object(v.jsx)("div",{style:{width:"100%",padding:"6px",height:"40px"},children:Object(v.jsx)("h1",{children:t})})}var y=Object(m.a)((function(e){return{root:{flexGrow:1},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1,paddingLeft:e.spacing(2)}}}));function k(){var e=y();return Object(v.jsx)("div",{className:e.root,children:Object(v.jsx)(j.a,{position:"static",children:Object(v.jsx)(p.a,{children:Object(v.jsx)("h1",{className:e.title,children:"Test Stand Control Software"})})})})}function E(e){var t=e.children,a=e.title,n=Object(b.a)(e,f);return Object(v.jsxs)("div",Object(u.a)(Object(u.a)({className:"panel"},n),{},{children:[Object(v.jsx)(w,{children:a}),Object(v.jsx)(O.a,{style:{width:"100%",height:"calc(100% - 52px"},children:t})]}))}var S=Object(x.a)((function(e){return{root:{width:60,height:32,padding:1,display:"flex"},switchBase:{padding:2,color:e.palette.grey[500],"&$checked":{transform:"translateX(26px)",color:e.palette.common.white,"& + $track":{opacity:1,backgroundColor:e.palette.primary.main,borderColor:e.palette.primary.main}}},thumb:{width:28,height:28,boxShadow:"none"},track:{border:"1px solid ".concat(e.palette.grey[500]),borderRadius:8,opacity:1,backgroundColor:e.palette.common.white},checked:{}}}))(g.a);Object(x.a)((function(e){return{root:{position:"absolute",top:"-10px",left:"-10px",width:"6vw"}}}))(g.a);function P(e){var t=e.value,a=e.setValue;return Object(v.jsxs)("div",{className:"toggle-switch",style:{width:60},children:[Object(v.jsx)("span",{className:t?"inactive":"active",children:"Off"}),Object(v.jsx)(S,{checked:t,onChange:function(){return a(!t)}}),Object(v.jsx)("span",{className:t?"active":"inactive",style:{textAlign:"right",width:"100%",display:"block"},children:"On"})]})}function C(e){var t="";t=e.children?e.children:"true"===e.isButton?Object(v.jsx)("button",{onClick:function(){return e.setSwitchValue("")},children:"ABORT"}):Object(v.jsx)(P,{value:e.switchValue,setValue:e.setSwitchValue});var a=e.label?{cursor:"help",borderBottom:"1px dotted #333"}:{};return Object(v.jsxs)("div",{className:"safety-card",children:[Object(v.jsx)("h2",{title:e.label,style:a,children:e.title}),t]})}function N(e){var t=e.state,a=e.emit,n=e.that,i=null!==t.data&&t.data.arming_switch,s=null!==t.data&&t.data.manual_switch,r=null!==t.data&&t.data.data_logging;return Object(v.jsx)(E,{title:"Safety",className:"panel safety",children:Object(v.jsxs)("div",{className:"flex",style:{justifyContent:"flex-start"},children:[Object(v.jsx)(C,{title:"Arming Switch",label:"Controls if the state can change",isButton:"false",switchValue:i,setSwitchValue:function(e){return a("ARMINGSWITCH",e)}}),Object(v.jsx)(C,{title:"Manual Control",label:"Allow manual pin operation",isButton:"false",switchValue:s,setSwitchValue:function(e){return a("MANUALSWITCH",e)}}),Object(v.jsx)(C,{title:"Data Logging",label:"Logging data",isButton:"false",switchValue:r,setSwitchValue:function(e){return a("DATALOG",e)}}),Object(v.jsxs)(C,{title:"Ping",label:"Time delay to reach the server",children:[t.ping?t.ping:"0","ms"]}),Object(v.jsx)(C,{title:"Raspberry Pi IP",label:"Local IP address of the Raspberry Pi. Must be on the same network. If it's incorrect no new data will appear",children:Object(v.jsx)("input",{value:t.wsAddress,onChange:function(e){n.setState({wsAddress:e.target.value},(function(){n.connect()}))},placeholder:t.defaultWSAddress})})]})})}var L=a(20),V=a(384),J=a(385),T=a(89),I=a(389),_=a(194),X=a(195),A=a(34),F=a(92),H=a(110),B=a(197);function W(e,t){return t.map((function(t){return{time:"t-"+((parseInt(e.data.time)-parseInt(t.time))/1e3).toFixed(3),LOX_N2_Pressure:t.LOX.analog[1],LOX_Tank_Pressure:t.LOX.analog[3],ETH_N2_Pressure:t.ETH.analog[1],ETH_Tank_Pressure:t.ETH.analog[3]}}))}function R(e){var t=e.state,a=(e.emit,o.a.useState(!1)),n=Object(L.a)(a,2),i=n[0],s=n[1],r=o.a.useState(W(t,t.history)),c=Object(L.a)(r,2),l=c[0],h=c[1],d=t.history.length,u=i?l:d>200?t.history.slice(d-200,-1):t.history,b=i?l:W(t,u);return Object(v.jsxs)(E,{title:"Graphs",className:"panel graphs",children:[Object(v.jsx)(V.a,{width:"100%",height:"90%",children:Object(v.jsxs)(J.a,{data:b,margin:{top:20,right:30,left:20,bottom:10},children:[Object(v.jsx)(T.a,{verticalAlign:"top",height:50}),Object(v.jsx)(I.a,{strokeDasharray:"3 3"}),Object(v.jsx)(_.a,{dataKey:"time"}),Object(v.jsx)(X.a,{children:Object(v.jsx)(A.a,{angle:270,position:"left",style:{textAnchor:"middle"},children:"Pressure (PSI)"})}),Object(v.jsx)(F.a,{position:{x:100,y:0}}),i?Object(v.jsx)(H.a,{}):null,Object(v.jsx)(B.a,{type:"monotone",dataKey:"LOX_N2_Pressure",stroke:"#ff0000"}),Object(v.jsx)(B.a,{type:"monotone",dataKey:"LOX_Tank_Pressure",stroke:"#000000"}),Object(v.jsx)(B.a,{type:"monotone",dataKey:"ETH_N2_Pressure",stroke:"#0099ff"}),Object(v.jsx)(B.a,{type:"monotone",dataKey:"ETH_Tank_Pressure",stroke:"#66ff99"})]})}),Object(v.jsx)(g.a,{checked:i,onChange:function(e){s(e.target.checked),i&&h(W(t,function(e){return e.filter((function(e,t){return t%2===0}))}(d>600?t.history.slice(d-600,-1):t.history)))}})," Analysis Mode"]})}var D=a(55),M=a.n(D),G=a(132),U=a(400),q=a(390),K=a(391),z=a(392),Q=a(393),$=a(394),Y=a(395),Z=a(396),ee=a(397),te=a(398),ae=a(399);function ne(e){var t,a=e.state,n=e.emit,i=null!==(t=a.data&&a.data.current_sequence)&&void 0!==t?t:[],s=null===a.data?null:a.data.sequence_executing,r=o.a.useState(!1),c=Object(L.a)(r,2),l=c[0],h=c[1],d=function(){var e=Object(G.a)(M.a.mark((function e(t){var a,i;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.target.files.length){e.next=2;break}return e.abrupt("return");case 2:if(a=t.target.files[0],!1===(i=j(a))){e.next=12;break}return e.t0=n,e.next=8,i;case 8:e.t1=e.sent,(0,e.t0)("SETSEQUENCE",e.t1),e.next=13;break;case 12:h(!0);case 13:t.target.value="";case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:",",a=e.split("\n"),n=a.map((function(e){return e.split(t).map((function(e){return e.trim()}))}));return n}var b=function(e){var t=new FileReader;return new Promise((function(a,n){t.onerror=function(){t.abort(),n(new DOMException("Problem parsing input file."))},t.onload=function(){a(t.result)},t.readAsText(e)}))};function j(e){return p.apply(this,arguments)}function p(){return(p=Object(G.a)(M.a.mark((function e(t){var a,n,i;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b(t);case 2:a=e.sent,n=u(a),i=[],e.prev=5,n.forEach((function(e){if("OPEN"===e[0]||"CLOSE"===e[0]){if(3!==e.length)throw new Error("invalid input");if("lox"!==e[1].toLowerCase()&&"eth"!==e[1].toLowerCase())throw new Error("invalid input");var t=Number.parseInt(e[2]);if(!t)throw new Error("invalid input");i.push({header:e[0],parameter:{name:e[1],pin:t}})}else{if("SLEEP"!==e[0]){if(""===e[0])return;throw new Error("invalid input")}if(2!==e.length)throw new Error("invalid input");var a=Number.parseInt(e[1]);if(!a)throw new Error("invalid input");i.push({header:e[0],parameter:a})}})),e.next=12;break;case 9:return e.prev=9,e.t0=e.catch(5),e.abrupt("return",!1);case 12:return e.abrupt("return",i);case 13:case"end":return e.stop()}}),e,null,[[5,9]])})))).apply(this,arguments)}return Object(v.jsxs)(E,{title:"Sequences",children:[Object(v.jsx)("div",{children:Object(v.jsxs)(U.a,{open:l,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[Object(v.jsx)(q.a,{id:"alert-dialog-title",children:"Invalid CSV"}),Object(v.jsx)(K.a,{children:Object(v.jsx)(z.a,{id:"alert-dialog-description",children:"Confirm the CSV given was valid, read documentation if unsure."})}),Object(v.jsx)(Q.a,{children:Object(v.jsx)($.a,{onClick:function(){h(!1)},color:"primary",autoFocus:!0,children:"Understood!"})})]})}),Object(v.jsxs)("div",{className:"flex",children:[Object(v.jsx)("div",{style:{width:"200px",borderRight:"1px solid #999",height:"100%"},children:Object(v.jsxs)("div",{className:"frame",children:[Object(v.jsx)("h2",{children:"Start Sequence"}),Object(v.jsx)("div",{children:Object(v.jsx)("input",{type:"file",accept:".csv",maxLength:"1",onChange:d})}),Object(v.jsx)("br",{}),Object(v.jsx)("button",{onClick:function(){return n("BEGINSEQUENCE",null)},children:"Start"}),Object(v.jsx)("br",{}),Object(v.jsx)("br",{}),Object(v.jsx)(C,{title:"Run Abort Sequence",isButton:"true",setSwitchValue:function(e){return n("ABORTSEQUENCE",e)}})]})}),Object(v.jsx)("div",{style:{overflow:"auto",width:"100%",height:"100%"},children:Object(v.jsxs)(Y.a,{stickyHeader:!0,"aria-label":"simple table",children:[Object(v.jsx)(Z.a,{children:Object(v.jsxs)(ee.a,{children:[Object(v.jsx)(te.a,{align:"center",children:"Command"}),Object(v.jsx)(te.a,{align:"center",children:"LabJack"}),Object(v.jsx)(te.a,{align:"center",children:"Value"})]})}),Object(v.jsxs)(ae.a,{children:[s&&Object(v.jsxs)(ee.a,{style:{background:"#94F690"},children:[Object(v.jsx)(te.a,{component:"th",scope:"row",children:s.header}),Object(v.jsx)(te.a,{align:"center",children:s.data.name&&s.data.name}),Object(v.jsx)(te.a,{align:"center",children:s.data.name?s.data.pin:((s.time-a.data.time)/1e3).toFixed(4)})]}),i.map((function(e){return Object(v.jsxs)(ee.a,{children:[Object(v.jsx)(te.a,{component:"th",scope:"row",children:e.header}),Object(v.jsx)(te.a,{align:"center",children:void 0===e.data.name?"":e.data.name}),Object(v.jsx)(te.a,{align:"center",children:void 0===e.data.name?e.data:e.data.pin})]})}))]})]})})]})]})}function ie(e){var t=e.state,a=e.emit;function n(e){return"".concat(26*e,"px")}var i=Object(u.a)({position:"absolute",borderStyle:"solid",borderColor:"transparent",width:n(e.width),height:n(e.height),top:n(e.y),left:n(e.x)},!e.enabled&&e.isButton?{cursor:"help"}:{}),s={position:"absolute",margin:"auto",fontSize:"1vw",top:n(e.y-1),left:n(e.x-1)};if(e.isButton){var r=null!==t.data&&t.data[e.testEnd].digital[e.pin];return Object(v.jsxs)("div",{children:[Object(v.jsxs)("div",{style:i,title:e.enabled?"":"Please enable the arming and manual control switches to toggle",children:[Object(v.jsx)(g.a,{checked:r,onChange:function(){return t.data[e.testEnd].digital[e.pin]?a("CLOSE",{name:e.testEnd,pin:parseInt(e.pin)}):a("OPEN",{name:e.testEnd,pin:parseInt(e.pin)})},disabled:!e.enabled}),Object(v.jsxs)("label",{className:(r?"active":"inactive")+" control-label "+(e.enabled?"":"disabled"),children:[Object(v.jsx)("br",{}),r?"On":"Off"]})]}),Object(v.jsx)("h4",{style:s,children:e.title})]})}var c=null===t.data?0:t.data[e.testEnd].analog[e.pin];return Object(v.jsxs)("div",{style:i,children:[Object(v.jsx)("div",{style:{fontSize:"1vw"},children:e.title}),Object(v.jsx)("div",{style:{fontSize:"1vw"},children:c&&c.toFixed(3)})]})}function se(e){var t=e.state,a=e.emit;return Object(v.jsx)(E,{title:"Control Panel",className:"panel control",children:Object(v.jsxs)("div",{className:"control-panel",children:[t.data&&re.map((function(e){return Object(v.jsx)(ie,{title:e.pin.nameShort,state:t,emit:a,pin:e.pin.labJackChanel,testEnd:e.pin.testEnd,width:e.position.width,height:e.position.height,x:e.position.x,y:e.position.y,enabled:t.data.arming_switch&&t.data.manual_switch,isButton:!0},e.pin.nameShort)})),t.data&&ce.map((function(e){return Object(v.jsx)(ie,{title:e.pin.nameShort,state:t,emit:a,pin:e.pin.labJackChanel,testEnd:e.pin.testEnd,width:e.position.width,height:e.position.height,x:e.position.x,y:e.position.y,enabled:t.data.arming_switch&&t.data.manual_switch,isButton:!1},e.pin.nameShort)}))]})})}var re=[{pin:{valve:11,labJackPin:"EIO6",labJackChanel:"14",testEnd:"ETH",name:"Main Fuel (Ethanol) Valve",nameShort:"E.L.V1"},position:{width:"2",height:"1",x:"11.5",y:"15"}},{pin:{valve:10,labJackPin:"CIO1",labJackChanel:"12",testEnd:"ETH",name:"Fuel (Ethanol) Fill Valve",nameShort:"E.DF.V1"},position:{width:"2",height:"1",x:"8",y:"13"}},{pin:{valve:9,labJackPin:"EIO2",labJackChanel:"10",testEnd:"ETH",name:"Fuel (Ethanol) Dump Valve",nameShort:"E.DF.V2"},position:{width:"2",height:"1",x:"4",y:"13"}},{pin:{valve:8,labJackPin:"EIO0",labJackChanel:"8",testEnd:"ETH",name:"Fuel (Ethanol) Tank Nitrogen Pressurisation Valve",nameShort:"N.L.E.V2"},position:{width:"2",height:"1",x:"8",y:"4"}},{pin:{valve:7,labJackPin:"CIO3",labJackChanel:"99",testEnd:"ETH",name:"Fuel (Ethanol) Tank Vent Valve",nameShort:"N.L.E.V3"},position:{width:"2",height:"1",x:"11",y:"1"}},{pin:{valve:6,labJackPin:"EIO4",labJackChanel:"17",testEnd:"ETH",name:"Fuel (Ethanol) Line Nitrogen Purge Valve",nameShort:"E.L.V2"},position:{width:"2",height:"1",x:"8",y:"17"}},{pin:{valve:5,labJackPin:"CIO0",labJackChanel:"16",testEnd:"LOX",name:"Main Oxidiser (LOX) Valve",nameShort:"O.L.V1"},position:{width:"2",height:"1",x:"17.5",y:"15"}},{pin:{valve:4,labJackPin:"CIO2",labJackChanel:"18",testEnd:"LOX",name:"Oxidiser (LOX) Fill Valve",nameShort:"O.DF.V1"},position:{width:"2",height:"1",x:"21",y:"13"}},{pin:{valve:3,labJackPin:"EIO1",labJackChanel:"9",testEnd:"LOX",name:"Oxidiser (LOX) Dump Valve",nameShort:"O.DF.V2"},position:{width:"2",height:"1",x:"25",y:"13"}},{pin:{valve:2,labJackPin:"EIO3",labJackChanel:"11",testEnd:"LOX",name:"Oxidiser (LOX) Tank Nitrogen Pressurisation Valve",nameShort:"N.L.O.V2"},position:{width:"2",height:"1",x:"21",y:"4"}},{pin:{valve:1,labJackPin:"EIO5",labJackChanel:"13",testEnd:"LOX",name:"Oxidiser (LOX) Tank Vent Valve",nameShort:"N.L.O.V3"},position:{width:"2",height:"1",x:"18",y:"1"}},{pin:{valve:0,labJackPin:"EIO7",labJackChanel:"15",testEnd:"LOX",name:"Oxidiser (LOX) Line Nitrogen Purge Valve",nameShort:"O.L.V2"},position:{width:"2",height:"1",x:"21",y:"17"}}],ce=[{pin:{sensorNumber:0,labJackPin:"FIO1",labJackChanel:"1",testEnd:"LOX",maxPressure:"250bar",name:"LOX Nitrogen Pressurant Sensor",nameShort:"(N.L.O.P1)"},position:{width:"5",height:"3",x:"25",y:"3"}},{pin:{sensorNumber:1,labJackPin:"FIO3",labJackChanel:"3",testEnd:"LOX",maxPressure:"160bar",name:"LOX Tank Pressure Sensor",nameShort:"(O.L.P1)"},position:{width:"3",height:"4.5",x:"17",y:"7.5"}},{pin:{sensorNumber:2,labJackPin:"FIO1",labJackChanel:"1",testEnd:"ETH",maxPressure:"250bar",name:"Ethanol Nitrogen Pressurant Sensor",nameShort:"(N.L.E.P1)"},position:{width:"5",height:"3",x:"1",y:"3"}},{pin:{sensorNumber:3,labJackPin:"FIO3",labJackChanel:"3",testEnd:"ETH",maxPressure:"160bar",name:"Ethanol Tank Pressure Sensor",nameShort:"(E.L.P1)"},position:{width:"3",height:"4.5",x:"11",y:"7.5"}}],le=a(402),oe=function(e){Object(r.a)(a,e);var t=Object(c.a)(a);function a(e){var i;return Object(n.a)(this,a),(i=t.call(this,e)).state={data:null,history:[],mostRecentWarning:{},showWarning:!1,wsAddress:"127.0.0.1",defaultWSAddress:"127.0.0.1"},i.emit=i.emit.bind(Object(s.a)(i)),i.connect(),i}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.interval=setInterval((function(){return e.emit("PING")}),200),this.mounted=!0}},{key:"componentWillUnmount",value:function(){this.mounted=!1,clearInterval(this.interval)}},{key:"connect",value:function(){var e=this;this.socket&&this.socket.close();try{this.socket=new WebSocket("ws://".concat(this.state.wsAddress,":8888")),this.socket.onopen=function(e){return console.log("websocket connection established")},this.socket.onclose=function(t){setTimeout((function(){e.socket||e.connect()}),1e3)},this.socket.onmessage=function(t){if(e.mounted){var a=JSON.parse(t.data);switch(a.type){case"STATE":e.state.history.push(a.data),e.state.history.length>1e6&&(e.state.history=e.state.history.slice(5e5,-1)),e.setState({data:a.data,history:e.state.history});break;case"PING":e.setState({ping:(new Date).getTime()-a.data});break;default:console.error(a)}}}}catch(t){console.error(t)}}},{key:"emit",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.socket.readyState===WebSocket.OPEN&&this.socket.send(JSON.stringify({command:{header:e,data:t},time:(new Date).getTime()}))}},{key:"render",value:function(){var e=this;return this.state.data&&this.state.data.latest_warning&&this.state.data.latest_warning.id!==this.state.mostRecentWarning.id&&(console.log(this.state.mostRecentWarning),this.setState({mostRecentWarning:this.state.data.latest_warning,showWarning:!0})),Object(v.jsxs)("div",{children:[Object(v.jsx)(k,{}),Object(v.jsxs)("div",{className:"panels-root",children:[Object(v.jsxs)("div",{className:"panel-row-1",children:[Object(v.jsx)(N,{state:this.state,emit:this.emit,that:this}),Object(v.jsx)(ne,{state:this.state,emit:this.emit})]}),Object(v.jsxs)("div",{className:"panel-row-2",children:[Object(v.jsx)(se,{state:this.state,emit:this.emit}),Object(v.jsx)(R,{state:this.state,emit:this.emit})]}),this.state.showWarning?Object(v.jsx)(le.a,{onClose:function(){e.setState({showWarning:!1})},severity:"error",className:"alert",children:this.state.mostRecentWarning.message}):null]})]})}}]),a}(o.a.Component);d.a.render(Object(v.jsx)(o.a.StrictMode,{children:Object(v.jsx)(oe,{})}),document.getElementById("root"))}},[[358,1,2]]]);
//# sourceMappingURL=main.969d13b7.chunk.js.map